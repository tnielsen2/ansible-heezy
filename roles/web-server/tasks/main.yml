---
- name: Install nginx
  apt:
    name: nginx
    state: present

- name: Start and enable nginx
  systemd:
    name: nginx
    state: started
    enabled: yes

- name: Configure basic nginx security
  blockinfile:
    path: /etc/nginx/nginx.conf
    insertafter: "http {"
    block: |
      server_tokens off;
      add_header X-Frame-Options DENY;
      add_header X-Content-Type-Options nosniff;
      add_header X-XSS-Protection "1; mode=block";
  notify: restart nginx

- name: Open firewall for HTTP/HTTPS
  ufw:
    rule: allow
    port: "{{ item }}"
  loop:
    - '80'
    - '443'

- name: Install certbot for SSL
  apt:
    name: 
      - certbot
      - python3-certbot-nginx
    state: present